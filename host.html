<!doctype html>
<html>
  <head>
    <title>Host</title>
    <style>
      table {
        width:100%;
      }
      table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
      }
      th, td {
        padding: 5px;
        text-align: left;
      }
      table#myTable tr:nth-child(even) {
        background-color: #eee;
      }
      table#myTable tr:nth-child(odd) {
       background-color:#fff;
      }
      table#myTable th	{
        background-color: black;
        color: white;
      }
    </style>
    <script>
    function insUserRow(userName) {
      var x = document.getElementById(myTable).insertRow(0);
      var y = x.insertCell(0);
      var z = x.insertCell(1);
      y.innerHTML = z.innerHTML = userName;
    }
    // function insertChannelColumn(id) {
    //   var x = document.getElementById(id);
    //   y = x.insertCell(0);
    //   y.innerHTML = "New Channel";
    // }
    </script>
  </head>
  <body>
    <h1>Host</h1>
    <content>
      <b>Room Name: </b> Not yet implemented
      <b>Your Name: </b> Not yet implemented
      <b>Role: </b> Technician
    </content>
    <content>
      <table id="myTable">
      <tr>
        <td>Name</td>
      </tr>
      <tr>

      </tr>
      </table>
    </content>
    <input type="button" onclick="insUserRow('Henry')" value="insUserRow">
    <!-- <input type="button" onclick="insertChannelColumn('myTable')" value="insertChannelColumn"> -->
    <h2>Clients</h2>
    <ol id="clients">
      <!-- List of connected clients with fadervalues. -->
    </ol>
    <h2>Channels</h2>
    <ol id="myFaders">
      <!-- List of faders that control My Monitor Mix -->
    </ol>

      <form id="channel" action="">
        <input id="newChannel" autocomplete="off"/><button>Add Channel</button>
      </form>

      <content id="views">
        <h2>Views</h2>
        <!-- List all views in this box -->

      </content>

    <button type="button" name="button">OK</button>

    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      var socket = io();
      socket.emit('userSendsID',"admin");

      var channelViewList = [];

      function addChannelView(name) {
        var newContent = document.createElement('content');
        newContent.id = name;
        var header = document.createTextNode(name);
        newContent.appendChild(header);
        document.body.appendChild(newContent);
        //add to channelViewList so that we easily can list all views in code
        channelViewList.push(name);
      }

      var myChannels =[]
      //initial sync reciever
      socket.on('allChannels',function(allChannels){
        console.log(allChannels);
        //add all recieved channels to list.
        myChannels = allChannels;
        for (var i = 0; i < myChannels.length; i++) {
          //add all recieved channels to view.
          addChannelToView(myChannels[i],'myFaders');
        }
      });
      //add channel to View with change-listener activated
      function addChannelToView(channelName,view) {
        var list = document.getElementById(view);
          var entry = document.createElement('li');
          var x = document.createElement("INPUT");
          var t = document.createTextNode(channelName);
          x.setAttribute("type", "range");
          x.value="0";
          x.id=channelName+view;

          entry.appendChild(x);
          entry.appendChild(t);
          list.appendChild(entry);
          //
          // //add change-event-listener
          // var channelId = '#'+channelName;
          // $(channelId).on("input change", function() {
          //   var channelValue = document.getElementById(channelName).value;
          //   socket.emit('setChannelValue',channelName,channelValue);
          //  });
        };

      // // Add client to list
      // var clientList = document.getElementById('clients');
      // socket.on('newUser',function(name){
      //   var entry = document.createElement('li');
      //   var userLabel = document.createTextNode(name);
      //   entry.appendChild(userLabel);
      //   clientList.appendChild(entry);
      // });

      // Add slider/faders live
      socket.on('newChannel', function(channelName){
        var entry = document.createElement('li');
        var x = document.createElement("INPUT");
        var t = document.createTextNode(channelName);
        x.setAttribute("type", "range");
        x.value="0";
        x.id=channelName;

        entry.appendChild(x);
        entry.appendChild(t);
        document.getElementById('myFaders').appendChild(entry);
        //Add to all views
        for (var i = 0; i < channelViewList.length; i++) {
          console.log(i);
          console.log("channelViewList[i] = ",channelViewList[i]);
          console.log(document.getElementById(channelViewList[i]));

          addChannelToView(channelName,channelViewList[i]);
        };
      });

      socket.on('newUser',function(channelList,userName){
        addChannelView(userName);
        for (var i = 0; i < channelList.length; i++) {
          addChannelToView(channelList[i],userName);
        };
      });

      // Update Faders live to client values
      socket.on('setChannelValue',function(userName,channelId,channelValue){
        console.log(userName," changed the value for ",channelId," to ",channelValue);
        var view = userName+"View";
        var fader = document.getElementById(channelId+userName);
        fader.value = channelValue;
      });

      // Listen for form action
      $('form').submit(function(){
        socket.emit('newChannel', $('#newChannel').val());
        $('#newChannel').val('');
        return false;
      });

    </script>
  </body>
</html>
